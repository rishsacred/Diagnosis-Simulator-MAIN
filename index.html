<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Diagnosis Simulator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a73e8;
            --secondary: #34a853;
            --danger: #ea4335;
            --warning: #fbbc05;
            --light: #f8f9fa;
            --dark: #202124;
            --gray: #5f6368;
            --light-gray: #dadce0;
            --bg: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
            --card-bg: #ffffff;
            --border: #e0e0e0;
            --shadow: 0 8px 30px rgba(0,0,0,0.08);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: var(--bg);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), #0d47a1);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="2"/></svg>');
            opacity: 0.3;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1;
        }
        
        .logo i {
            font-size: 2.5rem;
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 50%;
        }
        
        .stats {
            display: flex;
            gap: 25px;
            background: rgba(255,255,255,0.2);
            padding: 12px 25px;
            border-radius: 30px;
            z-index: 1;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-item span {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .stat-item strong {
            font-size: 1.4rem;
            margin-top: 5px;
        }
        
        .game-area {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
        }
        
        @media (max-width: 900px) {
            .game-area {
                grid-template-columns: 1fr;
            }
        }
        
        .patient-card {
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 25px;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .patient-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .patient-avatar {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: linear-gradient(45deg, #64b5f6, #90caf9);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .patient-info h2 {
            margin-bottom: 8px;
            font-size: 1.8rem;
        }
        
        .patient-info p {
            color: var(--gray);
            font-size: 1.1rem;
        }
        
        .patient-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .detail-card {
            background: var(--light);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid var(--primary);
            box-shadow: 0 3px 10px rgba(0,0,0,0.03);
            transition: transform 0.3s ease;
        }
        
        .detail-card:hover {
            transform: translateY(-3px);
        }
        
        .detail-card h3 {
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .detail-card h3 i {
            font-size: 1.2rem;
        }
        
        .symptoms {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 12px;
        }
        
        .symptom-tag {
            background: #e3f2fd;
            color: var(--primary);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .action-buttons {
            display: flex;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            font-size: 1.05rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.12);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .diagnosis-select {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 25px 0;
        }
        
        select {
            width: 100%;
            padding: 16px;
            border: 2px solid var(--light-gray);
            border-radius: 12px;
            font-size: 1.1rem;
            background: white;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.2em;
        }
        
        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
        }
        
        .disease-images {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding: 15px 5px;
            margin: 25px 0;
        }
        
        .disease-img {
            width: 180px;
            height: 180px;
            border-radius: 12px;
            background: linear-gradient(45deg, #f5f7fa, #e4e7eb);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            color: var(--gray);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            padding: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .disease-img:hover {
            transform: translateY(-5px);
        }
        
        .disease-img i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .lab-results {
            background: var(--light);
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.03);
        }
        
        .lab-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .lab-table th, .lab-table td {
            padding: 15px 20px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        .lab-table th {
            background: #e3f2fd;
            color: var(--primary);
            font-weight: 600;
        }
        
        .lab-table tr:nth-child(even) {
            background: rgba(0,0,0,0.02);
        }
        
        .lab-table tr:hover {
            background: rgba(26, 115, 232, 0.05);
        }
        
        .feedback-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            margin-top: 25px;
            border: 2px solid var(--secondary);
            box-shadow: var(--shadow);
            display: none;
        }
        
        .feedback-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            color: var(--secondary);
        }
        
        .disease-db {
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 25px;
            height: fit-content;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .disease-db h2 {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .disease-list {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .disease-list::-webkit-scrollbar {
            width: 8px;
        }
        
        .disease-list::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.05);
            border-radius: 10px;
        }
        
        .disease-list::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }
        
        .disease-item {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 10px;
        }
        
        .disease-item:hover {
            background: rgba(26, 115, 232, 0.05);
            transform: translateX(5px);
        }
        
        .disease-item h3 {
            margin-bottom: 10px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .disease-symptoms {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        .disease-symptom {
            background: #e8f5e9;
            color: var(--secondary);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        
        .disease-info {
            font-size: 0.95rem;
            color: var(--gray);
            margin-top: 10px;
        }
        
        .progress-container {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .progress-bar {
            height: 12px;
            background: var(--light-gray);
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 60%;
            border-radius: 10px;
        }
        
        .timer {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            font-weight: 600;
            color: var(--gray);
            font-size: 1.1rem;
        }
        
        .ai-hint {
            background: #e8f0fe;
            border-radius: 12px;
            padding: 20px;
            margin: 25px 0;
            display: flex;
            gap: 15px;
            align-items: flex-start;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary);
        }
        
        .ai-hint i {
            color: var(--primary);
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        footer {
            text-align: center;
            padding: 25px;
            margin-top: 30px;
            color: var(--gray);
            font-size: 1rem;
            border-top: 1px solid var(--border);
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            
            .stats {
                width: 100%;
                justify-content: center;
            }
            
            .patient-header {
                flex-direction: column;
                text-align: center;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .patient-avatar {
                margin: 0 auto;
            }
        }
        
        /* Animation for new content */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-heartbeat"></i>
                <div>
                    <h1>Medical Diagnosis Simulator</h1>
                    <p>Test your diagnostic skills with realistic patient cases</p>
                </div>
            </div>
            <div class="stats">
                <div class="stat-item">
                    <span>Score</span>
                    <strong id="score">0</strong>
                </div>
                <div class="stat-item">
                    <span>Cases Solved</span>
                    <strong id="cases-solved">0</strong>
                </div>
                <div class="stat-item">
                    <span>Streak</span>
                    <strong id="streak">0</strong>
                </div>
            </div>
        </header>
        
        <div class="game-area">
            <div class="main-content">
                <div class="patient-card fade-in">
                    <div class="patient-header">
                        <div class="patient-avatar">MJ</div>
                        <div class="patient-info">
                            <h2>Marcus Johnson</h2>
                            <p>42 years old • Male • Construction Worker</p>
                        </div>
                    </div>
                    
                    <div class="patient-details">
                        <div class="detail-card">
                            <h3><i class="fas fa-stethoscope"></i> Presenting Symptoms</h3>
                            <div class="symptoms">
                                <span class="symptom-tag"><i class="fas fa-thermometer-full"></i> Fever (102°F)</span>
                                <span class="symptom-tag"><i class="fas fa-lungs"></i> Persistent cough</span>
                                <span class="symptom-tag"><i class="fas fa-bed"></i> Night sweats</span>
                            </div>
                        </div>
                        
                        <div class="detail-card">
                            <h3><i class="fas fa-history"></i> Medical History</h3>
                            <p>Smoker (20 pack-years), Type 2 diabetes, Hypertension</p>
                        </div>
                        
                        <div class="detail-card">
                            <h3><i class="fas fa-users"></i> Family History</h3>
                            <p>Father: Heart disease (age 62), Mother: Type 2 diabetes</p>
                        </div>
                        
                        <div class="detail-card">
                            <h3><i class="fas fa-pills"></i> Current Medications</h3>
                            <p>Metformin 1000mg daily, Lisinopril 10mg daily</p>
                        </div>
                        
                        <div class="detail-card">
                            <h3><i class="fas fa-smoking"></i> Addictions</h3>
                            <p>Smoking: 1 pack/day, Alcohol: 4-6 beers/weekend</p>
                        </div>
                    </div>
                    
                    <div class="ai-hint">
                        <i class="fas fa-robot"></i>
                        <div>As an AI assistant, I suggest ordering a chest X-ray and sputum culture to investigate the persistent respiratory symptoms. The patient's smoking history and diabetes are significant risk factors.</div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" id="ask-more">
                            <i class="fas fa-question-circle"></i> Ask More Questions
                        </button>
                        <button class="btn btn-primary" id="order-labs">
                            <i class="fas fa-flask"></i> Order Tests
                        </button>
                        <button class="btn btn-warning" id="make-diagnosis">
                            <i class="fas fa-stethoscope"></i> Make Diagnosis
                        </button>
                    </div>
                    
                    <div class="lab-results" id="lab-results" style="display: none;">
                        <h3><i class="fas fa-vial"></i> Lab Results</h3>
                        <table class="lab-table">
                            <thead>
                                <tr>
                                    <th>Test</th>
                                    <th>Result</th>
                                    <th>Reference Range</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>CBC - WBC</td>
                                    <td>12,500/μL</td>
                                    <td>4,500-11,000/μL</td>
                                    <td style="color: var(--danger); font-weight: bold;">High</td>
                                </tr>
                                <tr>
                                    <td>Chest X-ray</td>
                                    <td>Cavitary lesions in upper lobes</td>
                                    <td>Normal lung fields</td>
                                    <td style="color: var(--danger); font-weight: bold;">Abnormal</td>
                                </tr>
                                <tr>
                                    <td>Sputum Culture</td>
                                    <td>Acid-fast bacilli detected</td>
                                    <td>No growth</td>
                                    <td style="color: var(--danger); font-weight: bold;">Positive</td>
                                </tr>
                                <tr>
                                    <td>Blood Glucose</td>
                                    <td>180 mg/dL</td>
                                    <td>70-100 mg/dL</td>
                                    <td style="color: var(--danger); font-weight: bold;">High</td>
                                </tr>
                                <tr>
                                    <td>HbA1c</td>
                                    <td>7.8%</td>
                                    <td>&lt;5.7%</td>
                                    <td style="color: var(--danger); font-weight: bold;">High</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="disease-images">
                        <div class="disease-img">
                            <i class="fas fa-x-ray"></i>
                            <div>Chest X-ray: Cavitary Lesions</div>
                        </div>
                        <div class="disease-img">
                            <i class="fas fa-microscope"></i>
                            <div>Sputum Sample: Acid-Fast Bacilli</div>
                        </div>
                        <div class="disease-img">
                            <i class="fas fa-weight"></i>
                            <div>Weight Chart: 15 lbs Loss</div>
                        </div>
                    </div>
                    
                    <div class="diagnosis-select" id="diagnosis-select" style="display: none;">
                        <h3><i class="fas fa-diagnoses"></i> Select Diagnosis</h3>
                        <select id="diagnosis-dropdown">
                            <option value="">-- Choose a diagnosis --</option>
                            <!-- Options will be populated by JavaScript -->
                        </select>
                        <button class="btn btn-secondary" id="submit-diagnosis">
                            <i class="fas fa-check"></i> Submit Diagnosis
                        </button>
                    </div>
                    
                    <div class="feedback-card" id="feedback">
                        <div class="feedback-header">
                            <i class="fas fa-clipboard-check"></i>
                            <h2>Diagnosis Feedback</h2>
                        </div>
                        <p><strong>Correct Diagnosis:</strong> Tuberculosis (Pulmonary)</p>
                        <p><strong>Explanation:</strong> Tuberculosis is caused by Mycobacterium tuberculosis. The patient presented with classic symptoms: persistent cough, fever, night sweats, and weight loss. The chest X-ray showing cavitary lesions and sputum culture with acid-fast bacilli confirm the diagnosis.</p>
                        <p><strong>Treatment:</strong> Standard four-drug regimen (Isoniazid, Rifampin, Pyrazinamide, Ethambutol) for 6 months. Isolation precautions required until no longer infectious.</p>
                        <button class="btn btn-secondary" id="next-case">
                            <i class="fas fa-arrow-right"></i> Next Patient
                        </button>
                    </div>
                </div>
                
                <div class="progress-container fade-in">
                    <h3><i class="fas fa-chart-line"></i> Current Case Progress</h3>
                    <div class="timer">
                        <i class="fas fa-clock"></i>
                        <span>Time Elapsed: <span id="timer">02:15</span></span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress"></div>
                    </div>
                    <p>Collect more information to improve your diagnostic accuracy. Current completion: 60%</p>
                </div>
            </div>
            
            <div class="disease-db fade-in">
                <h2><i class="fas fa-book-medical"></i> Disease Database</h2>
                <div class="disease-list" id="disease-list">
                    <!-- Disease items will be populated by JavaScript -->
                </div>
            </div>
        </div>
        
        <footer>
            <p>Medical Diagnosis Simulator &copy; 2023 | For educational purposes only | Not actual medical advice</p>
        </footer>
    </div>

    <script>
        // Expanded disease database with 20 entries
        const diseases = [
            {
                id: 1,
                name: "Tuberculosis (Pulmonary)",
                symptoms: ["Persistent cough", "Fever", "Night sweats", "Weight loss", "Hemoptysis", "Fatigue"],
                labResults: {
                    "Chest X-ray": "Cavitary lesions in upper lobes",
                    "Sputum Culture": "Acid-fast bacilli detected",
                    "PPD Test": "Positive",
                    "WBC": "Elevated"
                },
                epidemiology: "More common in immunocompromised, crowded living conditions, healthcare workers",
                treatment: "Multi-drug therapy for 6-9 months",
                explanation: "Tuberculosis is caused by Mycobacterium tuberculosis. It primarily affects the lungs but can spread to other organs. The bacteria are airborne and can remain dormant for years before becoming active."
            },
            {
                id: 2,
                name: "Systemic Lupus Erythematosus (SLE)",
                symptoms: ["Butterfly rash", "Joint pain", "Fatigue", "Fever", "Photosensitivity", "Raynaud's phenomenon"],
                labResults: {
                    "ANA": "Positive",
                    "Anti-dsDNA": "Positive",
                    "CBC": "Anemia, leukopenia",
                    "Urinalysis": "Proteinuria, hematuria"
                },
                epidemiology: "90% of cases in women, typically ages 15-45, higher in African Americans and Hispanics",
                treatment: "NSAIDs, antimalarials, corticosteroids, immunosuppressants",
                explanation: "SLE is an autoimmune disease where the body's immune system attacks its own tissues. It can affect multiple systems including skin, joints, kidneys, blood cells, brain, heart and lungs."
            },
            {
                id: 3,
                name: "Type 1 Diabetes Mellitus",
                symptoms: ["Polyuria", "Polydipsia", "Polyphagia", "Weight loss", "Fatigue", "Blurred vision"],
                labResults: {
                    "Fasting Glucose": ">126 mg/dL",
                    "HbA1c": ">6.5%",
                    "C-peptide": "Low",
                    "Urinalysis": "Glucosuria, ketonuria"
                },
                epidemiology: "Typically diagnosed in children and young adults, autoimmune etiology",
                treatment: "Lifelong insulin therapy, blood glucose monitoring, carbohydrate counting",
                explanation: "Type 1 diabetes results from autoimmune destruction of pancreatic beta cells, leading to absolute insulin deficiency. Without insulin, glucose cannot enter cells and builds up in the bloodstream."
            },
            {
                id: 4,
                name: "Multiple Sclerosis",
                symptoms: ["Vision loss", "Paresthesia", "Weakness", "Balance problems", "Bladder dysfunction", "Cognitive changes"],
                labResults: {
                    "MRI Brain": "Periventricular white matter lesions",
                    "CSF Analysis": "Oligoclonal bands",
                    "Evoked Potentials": "Delayed"
                },
                epidemiology: "Onset typically between 20-40 years, more common in women, higher prevalence in temperate climates",
                treatment: "Disease-modifying therapies, corticosteroids for relapses, symptom management",
                explanation: "MS is an autoimmune disorder where the immune system attacks the myelin sheath of nerve fibers in the central nervous system, causing communication problems between the brain and the body."
            },
            {
                id: 5,
                name: "Appendicitis",
                symptoms: ["Right lower quadrant pain", "Anorexia", "Nausea/vomiting", "Fever", "Rebound tenderness", "Migration of pain from periumbilical to RLQ"],
                labResults: {
                    "WBC": "Elevated (typically >10,000/μL)",
                    "CRP": "Elevated",
                    "Ultrasound/CT": "Inflamed appendix, possible appendicolith"
                },
                epidemiology: "Most common in adolescents and young adults, lifetime risk 7-8%",
                treatment: "Surgical appendectomy, antibiotics for perforated cases",
                explanation: "Appendicitis is inflammation of the appendix, usually caused by obstruction of the appendiceal lumen. Without prompt treatment, it can lead to perforation and peritonitis."
            },
            {
                id: 6,
                name: "Iron Deficiency Anemia",
                symptoms: ["Fatigue", "Pallor", "Shortness of breath", "Headache", "Pica", "Koilonychia (spoon nails)"],
                labResults: {
                    "CBC": "Microcytic hypochromic anemia",
                    "Ferritin": "Low",
                    "TIBC": "High",
                    "Transferrin saturation": "Low"
                },
                epidemiology: "Common in women of childbearing age (due to menstruation), infants, and adolescents",
                treatment: "Oral iron supplementation, address underlying cause, dietary changes",
                explanation: "Iron deficiency anemia develops when body iron stores are depleted, leading to impaired hemoglobin synthesis. This results in reduced oxygen-carrying capacity of the blood."
            },
            {
                id: 7,
                name: "Celiac Disease",
                symptoms: ["Diarrhea", "Abdominal bloating", "Weight loss", "Fatigue", "Dermatitis herpetiformis", "Iron deficiency"],
                labResults: {
                    "Anti-tTG IgA": "Positive",
                    "EMA IgA": "Positive",
                    "Endoscopy": "Villous atrophy, crypt hyperplasia"
                },
                epidemiology: "Prevalence ~1% in populations of European descent, associated with HLA-DQ2/DQ8",
                treatment: "Strict lifelong gluten-free diet, nutritional supplementation",
                explanation: "Celiac disease is an autoimmune disorder triggered by gluten ingestion in genetically predisposed individuals, causing inflammation and damage to the small intestinal lining."
            },
            {
                id: 8,
                name: "Rheumatoid Arthritis",
                symptoms: ["Symmetrical joint swelling", "Morning stiffness >1 hour", "Fatigue", "Rheumatoid nodules", "Malaise"],
                labResults: {
                    "Rheumatoid Factor": "Positive in 70-80%",
                    "Anti-CCP": "Positive",
                    "ESR/CRP": "Elevated",
                    "X-ray": "Juxta-articular osteoporosis, erosions"
                },
                epidemiology: "Affects 0.5-1% of adults, women 2-3 times more than men, peak onset 30-50 years",
                treatment: "DMARDs, biologics, NSAIDs, corticosteroids",
                explanation: "RA is a chronic systemic autoimmune disease primarily affecting the joints, characterized by synovial inflammation leading to cartilage destruction and bone erosion."
            },
            {
                id: 9,
                name: "Pneumonia",
                symptoms: ["Cough", "Fever", "Dyspnea", "Pleuritic chest pain", "Sputum production", "Crackles on auscultation"],
                labResults: {
                    "Chest X-ray": "Lobar consolidation",
                    "WBC": "Elevated",
                    "CRP": "Elevated",
                    "Sputum Gram stain": "Gram-positive diplococci (in pneumococcal)"
                },
                epidemiology: "Common in extremes of age, immunocompromised, smokers, and during winter months",
                treatment: "Antibiotics based on suspected pathogen, supportive care, vaccination prevention",
                explanation: "Pneumonia is an infection that inflames the air sacs in one or both lungs, which may fill with fluid or pus. Can be caused by bacteria, viruses, or fungi."
            },
            {
                id: 10,
                name: "Hypothyroidism",
                symptoms: ["Fatigue", "Weight gain", "Cold intolerance", "Constipation", "Dry skin", "Bradycardia"],
                labResults: {
                    "TSH": "Elevated",
                    "Free T4": "Low",
                    "Lipid Panel": "Elevated LDL and total cholesterol"
                },
                epidemiology: "More common in women, incidence increases with age, Hashimoto's thyroiditis is most common cause",
                treatment: "Levothyroxine replacement therapy, regular monitoring of TSH levels",
                explanation: "Hypothyroidism results from inadequate production of thyroid hormones by the thyroid gland, leading to a slowing of metabolic processes throughout the body."
            },
            {
                id: 11,
                name: "Gout",
                symptoms: ["Sudden severe joint pain", "Redness and swelling", "Warmth in affected joint", "Limited range of motion", "Tophi (late stage)"],
                labResults: {
                    "Serum Uric Acid": "Elevated (>6.8 mg/dL)",
                    "Joint Fluid Analysis": "Urate crystals",
                    "ESR/CRP": "Elevated during attack"
                },
                epidemiology: "More common in men, postmenopausal women, associated with obesity, hypertension, alcohol consumption",
                treatment: "NSAIDs, colchicine, corticosteroids for acute attacks; allopurinol for long-term management",
                explanation: "Gout is a form of inflammatory arthritis characterized by recurrent attacks of a red, tender, hot, and swollen joint, caused by deposition of monosodium urate crystals."
            },
            {
                id: 12,
                name: "Peptic Ulcer Disease",
                symptoms: ["Burning epigastric pain", "Pain relieved by food or antacids", "Nausea", "Bloating", "Heartburn"],
                labResults: {
                    "Endoscopy": "Gastric or duodenal ulcer",
                    "H. pylori test": "Positive (stool antigen, breath test)",
                    "Hemoglobin": "May be low if bleeding"
                },
                epidemiology: "Associated with H. pylori infection, NSAID use, smoking, stress",
                treatment: "PPIs, antibiotics for H. pylori, avoidance of NSAIDs and irritants",
                explanation: "Peptic ulcer disease involves break in the lining of the stomach or duodenum, most commonly due to H. pylori infection or NSAID use. Can lead to complications like bleeding or perforation."
            },
            {
                id: 13,
                name: "Asthma",
                symptoms: ["Wheezing", "Shortness of breath", "Chest tightness", "Cough (especially at night)", "Symptoms triggered by allergens/exercise"],
                labResults: {
                    "Pulmonary Function Test": "Obstructive pattern, reversible with bronchodilator",
                    "Chest X-ray": "Hyperinflation (during attack)",
                    "Allergy Testing": "May be positive"
                },
                epidemiology: "Common in children, can develop at any age, associated with atopy, family history",
                treatment: "Inhaled corticosteroids, bronchodilators, leukotriene modifiers, avoidance of triggers",
                explanation: "Asthma is a chronic inflammatory disorder of the airways characterized by bronchial hyperresponsiveness and reversible airflow obstruction, leading to recurrent episodes of wheezing and breathlessness."
            },
            {
                id: 14,
                name: "Diverticulitis",
                symptoms: ["Left lower quadrant pain", "Fever", "Nausea/vomiting", "Change in bowel habits", "Abdominal tenderness"],
                labResults: {
                    "WBC": "Elevated",
                    "CRP": "Elevated",
                    "CT Abdomen": "Colonic diverticula with inflammation"
                },
                epidemiology: "More common in older adults, associated with low-fiber diet, obesity, sedentary lifestyle",
                treatment: "Antibiotics, bowel rest, liquid diet; surgery for complications or recurrent cases",
                explanation: "Diverticulitis is inflammation or infection of diverticula (small pouches) that can form in the colon wall, most commonly in the sigmoid colon."
            },
            {
                id: 15,
                name: "Endometriosis",
                symptoms: ["Pelvic pain (cyclic)", "Dysmenorrhea", "Dyspareunia", "Infertility", "Pain with bowel movements/urination"],
                labResults: {
                    "Ultrasound": "Endometriomas (chocolate cysts)",
                    "Laparoscopy": "Gold standard for diagnosis",
                    "CA-125": "May be elevated"
                },
                epidemiology: "Affects 6-10% of women of reproductive age, often diagnosed in 30s-40s, family history is risk factor",
                treatment: "NSAIDs, hormonal therapy (OCPs, progestins), GnRH agonists, surgery",
                explanation: "Endometriosis is a condition where tissue similar to the uterine lining grows outside the uterus, causing inflammation, pain, and adhesions. Can lead to infertility."
            },
            {
                id: 16,
                name: "Chronic Kidney Disease",
                symptoms: ["Fatigue", "Edema", "Shortness of breath", "Nausea/vomiting", "Pruritus", "Changes in urine output"],
                labResults: {
                    "Serum Creatinine": "Elevated",
                    "eGFR": "Decreased",
                    "Urinalysis": "Proteinuria, hematuria",
                    "Ultrasound": "Small, echogenic kidneys"
                },
                epidemiology: "Associated with diabetes, hypertension, cardiovascular disease, family history",
                treatment: "Control underlying conditions, ACE inhibitors/ARBs, dietary modifications, dialysis or transplant in advanced stages",
                explanation: "CKD is progressive loss of kidney function over months or years, defined as decreased GFR or kidney damage for ≥3 months. Can progress to end-stage renal disease."
            },
            {
                id: 17,
                name: "Parkinson's Disease",
                symptoms: ["Resting tremor", "Bradykinesia", "Rigidity", "Postural instability", "Shuffling gait", "Masked facies"],
                labResults: {
                    "Clinical Diagnosis": "Based on history and exam",
                    "DaTscan": "May show reduced dopamine transporter uptake",
                    "MRI Brain": "Typically normal (rule out other causes)"
                },
                epidemiology: "Average age of onset ~60 years, more common in men, most cases are sporadic",
                treatment: "Levodopa/carbidopa, dopamine agonists, MAO-B inhibitors, deep brain stimulation in advanced cases",
                explanation: "Parkinson's is a progressive neurodegenerative disorder characterized by loss of dopaminergic neurons in the substantia nigra, leading to motor and non-motor symptoms."
            },
            {
                id: 18,
                name: "Psoriasis",
                symptoms: ["Erythematous plaques with silvery scales", "Itching", "Nail pitting", "Joint pain (in psoriatic arthritis)"],
                labResults: {
                    "Clinical Diagnosis": "Based on appearance",
                    "Skin Biopsy": "Hyperkeratosis, parakeratosis, Munro microabscesses",
                    "ESR/CRP": "May be elevated in psoriatic arthritis"
                },
                epidemiology: "Onset peaks at 20-30 and 50-60 years, positive family history in 30%, associated with HLA-Cw6",
                treatment: "Topical steroids, vitamin D analogs, phototherapy, systemic agents (methotrexate, biologics)",
                explanation: "Psoriasis is a chronic immune-mediated skin disorder characterized by accelerated keratinocyte proliferation, leading to thickened, scaly plaques. Often associated with systemic inflammation."
            },
            {
                id: 19,
                name: "Hepatitis B",
                symptoms: ["Fatigue", "Jaundice", "Dark urine", "Abdominal pain", "Nausea/vomiting", "Arthralgia"],
                labResults: {
                    "HBsAg": "Positive",
                    "Anti-HBc IgM": "Positive in acute infection",
                    "Liver Enzymes": "Elevated AST/ALT",
                    "Bilirubin": "Elevated"
                },
                epidemiology: "Endemic in Asia and Africa, transmitted via blood/body fluids, vertical transmission, IV drug use",
                treatment: "Supportive care for acute infection; antivirals (tenofovir, entecavir) for chronic infection",
                explanation: "Hepatitis B is a viral infection that attacks the liver and can cause both acute and chronic disease. Chronic infection can lead to cirrhosis and hepatocellular carcinoma."
            },
            {
                id: 20,
                name: "Migraine",
                symptoms: ["Unilateral throbbing headache", "Photophobia", "Phonophobia", "Nausea/vomiting", "Aura (visual, sensory)"],
                labResults: {
                    "Clinical Diagnosis": "Based on history",
                    "Neuroimaging": "Typically normal (to rule out other causes)",
                    "ESR": "Normal (to rule out giant cell arteritis)"
                },
                epidemiology: "More common in women (3:1), peak prevalence 30-39 years, strong genetic component",
                treatment: "Acute: Triptans, NSAIDs; Preventive: Beta-blockers, anticonvulsants, antidepressants, CGRP antagonists",
                explanation: "Migraine is a primary headache disorder characterized by recurrent attacks of moderate to severe headache with associated symptoms. Pathophysiology involves cortical spreading depression and trigeminal activation."
            }
        ];

        // Game state
        let gameState = {
            score: 0,
            casesSolved: 0,
            streak: 0,
            currentPatient: null,
            currentDisease: null,
            labsOrdered: false,
            diagnosisMade: false,
            timer: 0,
            timerInterval: null
        };

        // DOM elements
        const scoreEl = document.getElementById('score');
        const casesSolvedEl = document.getElementById('cases-solved');
        const streakEl = document.getElementById('streak');
        const askMoreBtn = document.getElementById('ask-more');
        const orderLabsBtn = document.getElementById('order-labs');
        const makeDiagnosisBtn = document.getElementById('make-diagnosis');
        const labResultsEl = document.getElementById('lab-results');
        const diagnosisSelectEl = document.getElementById('diagnosis-select');
        const diagnosisDropdown = document.getElementById('diagnosis-dropdown');
        const submitDiagnosisBtn = document.getElementById('submit-diagnosis');
        const feedbackEl = document.getElementById('feedback');
        const nextCaseBtn = document.getElementById('next-case');
        const diseaseListEl = document.getElementById('disease-list');
        const timerEl = document.getElementById('timer');

        // Initialize game
        function initGame() {
            renderDiseaseDatabase();
            populateDiagnosisDropdown();
            startNewCase();
            startTimer();
            
            // Event listeners
            askMoreBtn.addEventListener('click', askMoreQuestions);
            orderLabsBtn.addEventListener('click', orderLabs);
            makeDiagnosisBtn.addEventListener('click', showDiagnosisInput);
            submitDiagnosisBtn.addEventListener('click', submitDiagnosis);
            nextCaseBtn.addEventListener('click', startNewCase);
        }

        // Render disease database
        function renderDiseaseDatabase() {
            diseaseListEl.innerHTML = '';
            
            diseases.forEach(disease => {
                const diseaseItem = document.createElement('div');
                diseaseItem.className = 'disease-item';
                
                let symptomsHTML = '';
                disease.symptoms.slice(0, 4).forEach(symptom => {
                    symptomsHTML += `<span class="disease-symptom">${symptom}</span>`;
                });
                
                diseaseItem.innerHTML = `
                    <h3><i class="fas fa-disease"></i> ${disease.name}</h3>
                    <div class="disease-symptoms">${symptomsHTML}</div>
                    <p class="disease-info">${disease.epidemiology.substring(0, 120)}...</p>
                `;
                
                diseaseItem.addEventListener('click', () => {
                    alert(`Disease Details: ${disease.name}\n\nSymptoms: ${disease.symptoms.join(', ')}\n\nEpidemiology: ${disease.epidemiology}\n\nTreatment: ${disease.treatment}\n\nExplanation: ${disease.explanation}`);
                });
                
                diseaseListEl.appendChild(diseaseItem);
            });
        }

        // Populate diagnosis dropdown
        function populateDiagnosisDropdown() {
            diagnosisDropdown.innerHTML = '<option value="">-- Choose a diagnosis --</option>';
            
            diseases.forEach(disease => {
                const option = document.createElement('option');
                option.value = disease.name;
                option.textContent = disease.name;
                diagnosisDropdown.appendChild(option);
            });
        }

        // Start a new patient case
        function startNewCase() {
            // Reset UI elements
            labResultsEl.style.display = 'none';
            diagnosisSelectEl.style.display = 'none';
            feedbackEl.style.display = 'none';
            
            // Reset buttons to initial state
            orderLabsBtn.innerHTML = `<i class="fas fa-flask"></i> Order Tests`;
            orderLabsBtn.disabled = false;
            askMoreBtn.innerHTML = `<i class="fas fa-question-circle"></i> Ask More Questions`;
            askMoreBtn.disabled = false;
            
            // Reset AI hint
            document.querySelector('.ai-hint').innerHTML = `
                <i class="fas fa-robot"></i>
                <div>As an AI assistant, I suggest ordering relevant tests based on the patient's symptoms. Consider starting with basic labs.</div>
            `;
            
            // Reset game state for the case
            gameState.labsOrdered = false;
            gameState.diagnosisMade = false;
            gameState.timer = 0;
            
            // Select a random disease
            const randomIndex = Math.floor(Math.random() * diseases.length);
            gameState.currentDisease = diseases[randomIndex];
            
            // Generate patient data
            generatePatientData();
            
            // Reset timer display
            updateTimerDisplay();
            
            // Add fade-in animation
            document.querySelector('.patient-card').classList.remove('fade-in');
            setTimeout(() => document.querySelector('.patient-card').classList.add('fade-in'), 10);
        }

        // Generate patient data based on current disease
        function generatePatientData() {
            const patient = {
                name: generateRandomName(),
                age: Math.floor(Math.random() * 50) + 18,
                occupation: getRandomOccupation(),
                symptoms: getRandomSymptoms(),
                history: getRandomHistory(),
                familyHistory: getRandomFamilyHistory(),
                medications: getRandomMedications(),
                addictions: getRandomAddictions()
            };
            
            gameState.currentPatient = patient;
            
            // Update UI with patient data
            document.querySelector('.patient-avatar').textContent = patient.name.split(' ').map(n => n[0]).join('');
            document.querySelector('.patient-info h2').textContent = patient.name;
            document.querySelector('.patient-info p').textContent = 
                `${patient.age} years old • ${Math.random() > 0.5 ? 'Male' : 'Female'} • ${patient.occupation}`;
            
            const symptomsEl = document.querySelector('.symptoms');
            symptomsEl.innerHTML = '';
            patient.symptoms.forEach(symptom => {
                const tag = document.createElement('span');
                tag.className = 'symptom-tag';
                tag.innerHTML = `<i class="fas fa-${getSymptomIcon(symptom)}"></i> ${symptom}`;
                symptomsEl.appendChild(tag);
            });
            
            document.querySelector('.detail-card:nth-child(2) p').textContent = patient.history;
            document.querySelector('.detail-card:nth-child(3) p').textContent = patient.familyHistory;
            document.querySelector('.detail-card:nth-child(4) p').textContent = patient.medications;
            document.querySelector('.detail-card:nth-child(5) p').textContent = patient.addictions;
        }

        // Get icon for symptom
        function getSymptomIcon(symptom) {
            const icons = {
                "Fever": "thermometer-full",
                "Cough": "lungs",
                "Fatigue": "tired",
                "Weight loss": "weight",
                "Joint pain": "bone",
                "Rash": "allergies",
                "Headache": "head-side-virus",
                "Nausea": "nauseous",
                "Shortness of breath": "wind",
                "Chest pain": "heartbeat",
                "Abdominal pain": "stomach"
            };
            
            for (const [key, value] of Object.entries(icons)) {
                if (symptom.includes(key)) return value;
            }
            return "exclamation-circle";
        }

        // Generate random name
        function generateRandomName() {
            const firstNames = ['James', 'Mary', 'Robert', 'Patricia', 'John', 'Jennifer', 'Michael', 'Linda', 'David', 'Elizabeth', 'Sarah', 'Thomas', 'Jessica', 'Christopher'];
            const lastNames = ['Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Garcia', 'Miller', 'Davis', 'Rodriguez', 'Martinez', 'Wilson', 'Anderson', 'Taylor'];
            return `${firstNames[Math.floor(Math.random() * firstNames.length)]} ${lastNames[Math.floor(Math.random() * lastNames.length)]}`;
        }

        // Get random occupation
        function getRandomOccupation() {
            const occupations = ['Teacher', 'Nurse', 'Software Engineer', 'Construction Worker', 'Accountant', 
                               'Retail Manager', 'Chef', 'Graphic Designer', 'Electrician', 'Marketing Executive',
                               'Police Officer', 'Student', 'Retired', 'Homemaker'];
            return occupations[Math.floor(Math.random() * occupations.length)];
        }

        // Get random symptoms for patient
        function getRandomSymptoms() {
            const disease = gameState.currentDisease;
            // Get 3-5 symptoms from the disease
            const symptomCount = Math.min(3 + Math.floor(Math.random() * 3), disease.symptoms.length);
            const shuffled = [...disease.symptoms].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, symptomCount);
        }

        // Get random medical history
        function getRandomHistory() {
            const histories = [
                'Hypertension, hyperlipidemia, former smoker (quit 5 years ago)',
                'No significant medical history, exercises regularly',
                'Type 2 diabetes, obesity, sedentary lifestyle',
                'Asthma, seasonal allergies, occasional NSAID use',
                'History of kidney stones, gout, moderate alcohol consumption',
                'GERD, depression, on SSRI medication',
                'Previous appendectomy, no other significant history',
                'Family history of heart disease, non-smoker, social drinker',
                'Migraines, IBS, vegetarian diet',
                'Osteoarthritis, hypothyroidism, takes levothyroxine'
            ];
            return histories[Math.floor(Math.random() * histories.length)];
        }
        
        // Get random family history
        function getRandomFamilyHistory() {
            const histories = [
                'Father: Heart disease (age 62), Mother: Type 2 diabetes',
                'Mother: Breast cancer (age 58), Father: Hypertension',
                'Sibling: Rheumatoid arthritis, Grandparent: Alzheimer\'s',
                'Father: Stroke (age 65), Mother: Osteoporosis',
                'No significant family history',
                'Mother: Lupus, Father: Colon cancer (age 70)',
                'Grandparents: Type 2 diabetes, Sibling: Asthma',
                'Father: Prostate cancer (age 72), Mother: Hypothyroidism',
                'Multiple family members with heart disease and diabetes',
                'Mother: Multiple sclerosis, Father: Parkinson\'s'
            ];
            return histories[Math.floor(Math.random() * histories.length)];
        }
        
        // Get random medications
        function getRandomMedications() {
            const medications = [
                'Metformin 1000mg daily, Lisinopril 10mg daily',
                'Atorvastatin 20mg daily, Metoprolol 25mg daily',
                'Levothyroxine 75mcg daily, Omeprazole 20mg daily',
                'No current medications',
                'Insulin glargine 20 units nightly, Aspirin 81mg daily',
                'Sertraline 50mg daily, Albuterol inhaler PRN',
                'Warfarin 5mg daily, Furosemide 40mg daily',
                'Hydrochlorothiazide 25mg daily, Atorvastatin 40mg daily',
                'Gabapentin 300mg TID, Tylenol PRN',
                'Levothyroxine 100mcg daily, Vitamin D 2000 IU daily'
            ];
            return medications[Math.floor(Math.random() * medications.length)];
        }
        
        // Get random addictions
        function getRandomAddictions() {
            const addictions = [
                'Smoking: 1 pack/day, Alcohol: 4-6 beers/weekend',
                'Former smoker (quit 10 years ago), Occasional alcohol',
                'No smoking, No alcohol',
                'Social smoker (1-2 cigarettes/day), Moderate alcohol (2-3 drinks/week)',
                'Alcohol: 2-3 drinks daily, Former smoker (quit 2 years ago)',
                'No addictions',
                'Former heavy drinker (sober 5 years), No smoking',
                'Vaping daily, Occasional marijuana use',
                'Alcohol: 1-2 drinks daily, No smoking',
                'Former IV drug user (sober 8 years)'
            ];
            return addictions[Math.floor(Math.random() * addictions.length)];
        }

        // Ask more questions
        function askMoreQuestions() {
            const disease = gameState.currentDisease;
            const additionalSymptoms = disease.symptoms.filter(s => 
                !gameState.currentPatient.symptoms.includes(s)
            );
            
            if (additionalSymptoms.length > 0) {
                const randomSymptom = additionalSymptoms[Math.floor(Math.random() * additionalSymptoms.length)];
                gameState.currentPatient.symptoms.push(randomSymptom);
                
                const tag = document.createElement('span');
                tag.className = 'symptom-tag';
                tag.innerHTML = `<i class="fas fa-${getSymptomIcon(randomSymptom)}"></i> ${randomSymptom}`;
                document.querySelector('.symptoms').appendChild(tag);
                
                // Add some visual feedback
                askMoreBtn.innerHTML = `<i class="fas fa-check"></i> Question Asked`;
                askMoreBtn.disabled = true;
                setTimeout(() => {
                    askMoreBtn.innerHTML = `<i class="fas fa-question-circle"></i> Ask More Questions`;
                    askMoreBtn.disabled = false;
                }, 1500);
            }
        }

        // Order lab tests
        function orderLabs() {
            labResultsEl.style.display = 'block';
            gameState.labsOrdered = true;
            
            // Add some visual feedback
            orderLabsBtn.innerHTML = `<i class="fas fa-check"></i> Tests Ordered`;
            orderLabsBtn.disabled = true;
        }

        // Show diagnosis input
        function showDiagnosisInput() {
            diagnosisSelectEl.style.display = 'block';
            diagnosisDropdown.focus();
            
            // If labs haven't been ordered, warn the player
            if (!gameState.labsOrdered) {
                const aiHint = document.querySelector('.ai-hint');
                aiHint.innerHTML = `
                    <i class="fas fa-robot"></i>
                    <div>You haven't ordered any tests yet. Making a diagnosis without test results may be challenging. Consider ordering tests for more information.</div>
                `;
            }
        }

        // Submit diagnosis
        function submitDiagnosis() {
            const userDiagnosis = diagnosisDropdown.value;
            const correctDiagnosis = gameState.currentDisease.name;
            
            // Simple diagnosis matching (could be enhanced)
            const isCorrect = userDiagnosis === correctDiagnosis;
            
            // Update game state
            gameState.diagnosisMade = true;
            clearInterval(gameState.timerInterval);
            
            // Update feedback UI
            feedbackEl.style.display = 'block';
            feedbackEl.innerHTML = `
                <div class="feedback-header">
                    <i class="fas fa-clipboard-check"></i>
                    <h2>Diagnosis Feedback</h2>
                </div>
                <p><strong>Your Diagnosis:</strong> ${userDiagnosis || 'None selected'}</p>
                <p><strong>Correct Diagnosis:</strong> ${correctDiagnosis}</p>
                <p style="color: ${isCorrect ? 'var(--secondary)' : 'var(--danger)'}; font-weight: bold; font-size: 1.2rem;">
                    ${isCorrect ? '✅ Correct Diagnosis!' : '❌ Incorrect Diagnosis'}
                </p>
                <p><strong>Explanation:</strong> ${gameState.currentDisease.explanation}</p>
                <p><strong>Treatment:</strong> ${gameState.currentDisease.treatment}</p>
                <p><strong>Epidemiology:</strong> ${gameState.currentDisease.epidemiology}</p>
                <button class="btn btn-secondary" id="next-case">
                    <i class="fas fa-arrow-right"></i> Next Patient
                </button>
            `;
            
            // Update score
            if (isCorrect) {
                gameState.score += 100;
                gameState.casesSolved++;
                gameState.streak++;
                
                // Bonus for speed and ordering tests
                if (gameState.timer < 180) gameState.score += 50; // Bonus for speed
                if (gameState.labsOrdered) gameState.score += 30; // Bonus for thoroughness
            } else {
                gameState.streak = 0;
            }
            
            // Update score display
            scoreEl.textContent = gameState.score;
            casesSolvedEl.textContent = gameState.casesSolved;
            streakEl.textContent = gameState.streak;
            
            // Re-attach event listener for next case
            document.getElementById('next-case').addEventListener('click', startNewCase);
        }

        // Start timer for current case
        function startTimer() {
            clearInterval(gameState.timerInterval);
            gameState.timer = 0;
            gameState.timerInterval = setInterval(() => {
                gameState.timer++;
                updateTimerDisplay();
            }, 1000);
        }

        // Update timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(gameState.timer / 60).toString().padStart(2, '0');
            const seconds = (gameState.timer % 60).toString().padStart(2, '0');
            timerEl.textContent = `${minutes}:${seconds}`;
        }

        // Initialize the game when the page loads
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>